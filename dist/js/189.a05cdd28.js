"use strict";(self["webpackChunkevent"]=self["webpackChunkevent"]||[]).push([[189],{189:function(t,e,a){a.r(e),a.d(e,{default:function(){return d}});var i=function(){var t=this,e=t._self._c;return e("div",[e("el-card",[e("div",{staticStyle:{"font-size":"20px","font-weight":"bold"},attrs:{slot:"header"},slot:"header"},[t._v(" 文章列表 ")]),e("div",{staticClass:"container"},[e("el-form",{ref:"filterForm",attrs:{"label-width":"80px",inline:"",model:t.formData}},[e("el-form-item",{attrs:{label:"文章分类"}},[e("el-select",{attrs:{placeholder:"请选择分类"},model:{value:t.formData.cate_id,callback:function(e){t.$set(t.formData,"cate_id",e)},expression:"formData.cate_id"}},t._l(t.ArtcleList,(function(t){return e("el-option",{key:t.id,attrs:{label:t.cate_name,value:t.id}})})),1)],1),e("el-form-item",{attrs:{label:"发布状态"}},[e("el-select",{attrs:{placeholder:"请选择状态"},model:{value:t.formData.state,callback:function(e){t.$set(t.formData,"state",e)},expression:"formData.state"}},[e("el-option",{attrs:{label:"已发布",value:"已发布"}}),e("el-option",{attrs:{label:"草稿",value:"草稿"}})],1)],1),[e("el-button",{on:{click:t.filterFn}},[t._v("筛选")]),e("el-button",{on:{click:t.resetFn}},[t._v("重置")])]],2),e("el-button",{on:{click:function(e){t.dialogVisible=!0}}},[t._v("发表文章")])],1),e("el-table",{staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:t.artcles.data}},[e("el-table-column",{attrs:{label:"文章标题",prop:"title"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-link",{attrs:{type:"primary"},on:{click:function(e){return t.artcleDetail(a.row.id)}}},[t._v(t._s(a.row.title))])]}}])}),e("el-table-column",{attrs:{label:"文章分类",prop:"cate_name"}}),e("el-table-column",{attrs:{label:"发布时间",prop:"pub_date"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",[t._v(t._s(t.$formatDate(a.row.pub_date)))])]}}])}),e("el-table-column",{attrs:{label:"状态",prop:"state"}}),e("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{on:{click:function(e){return t.deleteArtcle(a.row.id)}}},[t._v("删除")])]}}])})],1),e("el-pagination",{staticStyle:{"text-align":"center"},attrs:{"current-page":t.formData.pagenum,"page-sizes":[5,10,15,20],"page-size":t.formData.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:t.artcles.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange,"update:currentPage":function(e){return t.$set(t.formData,"pagenum",e)},"update:current-page":function(e){return t.$set(t.formData,"pagenum",e)},"update:pageSize":function(e){return t.$set(t.formData,"pagesize",e)},"update:page-size":function(e){return t.$set(t.formData,"pagesize",e)}}})],1),e("el-dialog",{attrs:{title:"发表文章",visible:t.dialogVisible,width:"30%","before-close":t.handleClose,fullscreen:""},on:{"update:visible":function(e){t.dialogVisible=e},close:t.dialogCloseFn}},[e("el-form",{ref:"pubFormRef",attrs:{model:t.pubForm,rules:t.pubFormRules,"label-width":"100px"}},[e("div",{staticClass:"top"},[e("div",{staticClass:"left"},[e("el-form-item",{attrs:{label:"文章封面"}},[e("img",{ref:"coverImg",attrs:{src:a(2921),alt:""},on:{click:t.selCover}}),e("input",{ref:"cover",attrs:{type:"file"},on:{change:t.chooseCover}})])],1),e("div",{staticClass:"right"},[e("el-form-item",{attrs:{label:"文章标题",prop:"title"}},[e("el-input",{attrs:{placeholder:"请输入标题"},model:{value:t.pubForm.title,callback:function(e){t.$set(t.pubForm,"title",e)},expression:"pubForm.title"}})],1),e("el-form-item",{attrs:{label:"文章分类",prop:"cate_id"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择分类"},model:{value:t.pubForm.cate_id,callback:function(e){t.$set(t.pubForm,"cate_id",e)},expression:"pubForm.cate_id"}},t._l(t.ArtcleList,(function(t){return e("el-option",{key:t.id,attrs:{label:t.cate_name,value:t.id}})})),1)],1),e("div",{staticClass:"btns"},[e("el-button",{on:{click:function(e){return t.operationFn("已发布")}}},[t._v("发布")]),e("el-button",{on:{click:function(e){return t.operationFn("草稿")}}},[t._v("存为草稿")])],1)],1)]),e("el-form-item",{attrs:{label:"文章内容",prop:"content"}},[e("quill-editor",{on:{change:t.contentChangeFn},model:{value:t.pubForm.content,callback:function(e){t.$set(t.pubForm,"content",e)},expression:"pubForm.content"}})],1)],1)],1),e("el-dialog",{staticClass:"detail",attrs:{title:"文章预览",visible:t.detailVisible,width:"80%",top:"20px"},on:{"update:visible":function(e){t.detailVisible=e}}},[e("h1",[t._v(t._s(t.detailArtcle.title))]),e("div",[e("span",[t._v("作者:"+t._s(t.detailArtcle.nickname||t.detailArtcle.username))]),e("span",[t._v("发布时间:"+t._s(t.$formatDate(t.detailArtcle.pub_date)))]),e("span",[t._v("所属分类:"+t._s(t.detailArtcle.cate_name))]),e("span",[t._v("状态:"+t._s(t.detailArtcle.state))])]),e("el-divider"),e("img",{attrs:{src:t.baseURL+t.detailArtcle.cover_img,alt:""}}),e("div",{staticStyle:{"text-indent":"2em"},domProps:{innerHTML:t._s(t.detailArtcle.content)}})],1)],1)},r=[],s=a(7877),l=a(2921),n=a(6361),o={name:"artList",data(){return{baseURL:n.v,dialogVisible:!1,detailVisible:!1,detailArtcle:{},formData:{pagenum:1,pagesize:5,cate_id:"",state:""},artcles:{},pubForm:{title:"",cate_id:"",content:"",cover_img:"",state:""},pubFormRules:{title:[{required:!0,message:"请输入文章标题",trigger:"blur"},{min:1,max:30,message:"文章标题的长度为1-30个字符",trigger:"blur"}],cate_id:[{required:!0,message:"请选择文章标题",trigger:"change"}],content:[{required:!0,message:"请输入文章内容",trigger:"blur"}]},ArtcleList:[]}},methods:{async handleClose(t){const e=await this.$confirm("此操作将导致文章信息丢失, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch((t=>t));"cancel"!==e&&t()},dialogCloseFn(){this.$refs.pubFormRef.resetFields(),this.pubForm.cover_img="",this.pubForm.content="",this.$refs.coverImg.setAttribute("src",l)},async getArtcleList(){const{data:t}=await(0,s.SD)();this.ArtcleList=t.data},selCover(){this.$refs.cover.click()},chooseCover(t){const e=t.target.files;if(0===e.length)this.$refs.coverImg.setAttribute("src",l);else{this.pubForm.cover_img=e[0];const t=URL.createObjectURL(e[0]);this.$refs.coverImg.setAttribute("src",t)}},async operationFn(t){this.pubForm.state=t,this.$refs.pubFormRef.validate((async t=>{if(!t)return this.$message.error("请完善文章信息！");if(!this.pubForm.cover_img)return this.$message.error("请选择文章封面！");const e=new FormData;Object.keys(this.pubForm).forEach((t=>{e.append(t,this.pubForm[t])}));const{data:a}=await(0,s.Eg)(e);if(0!==a.code)return this.$message.error(a.message);this.$message.success("发布文章成功！"),this.dialogVisible=!1,this.initArtcles(),location.reload()}))},contentChangeFn(){this.$refs.pubFormRef.validateField("content")},async initArtcles(){const{data:t}=await(0,s.Nl)(this.formData);this.artcles=t},handleSizeChange(t){this.formData.pagenum=1,this.initArtcles(this.formData)},handleCurrentChange(t){this.initArtcles(this.formData)},filterFn(){this.formData.pagenum=1,this.formData.pagesize=5,this.initArtcles()},resetFn(){this.formData.pagenum=1,this.formData.pagesize=5,this.formData.cate_id="",this.formData.state="",this.initArtcles()},async artcleDetail(t){const{data:e}=await(0,s.xh)(t);if(0!==e.code)return this.$message.error(e.message);this.detailVisible=!0,this.detailArtcle=e.data},async deleteArtcle(t){const{data:e}=await(0,s.WC)(t);if(0!==e.code)return this.$message.error(e.message);this.$message.success(e.message),1===this.artcles.data.length&&this.formData.pagenum>1&&this.formData.pagenum--,this.initArtcles()}},created(){this.getArtcleList(),this.initArtcles()}},c=o,u=a(1001),m=(0,u.Z)(c,i,r,!1,null,"1eb4afaf",null),d=m.exports},2921:function(t,e,a){t.exports=a.p+"img/cover.54bfb07c.jpg"}}]);
//# sourceMappingURL=189.a05cdd28.js.map